{% extends "base.html" %}

{% block title %}Panel Dawcy{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="fw-bold">Witaj, <span class="text-danger">{{ imie }}</span>!</h1>
        <p class="text-muted mb-0">Twoje centrum krwiodawstwa.</p>
    </div>
    <a href="/logout" class="btn btn-outline-secondary">üö™ Wyloguj</a>
</div>

<div class="row g-4">

    <div class="col-lg-8">

        <div class="card shadow mb-4">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Tw√≥j cel pomocy</h5>
                <span class="badge bg-light text-dark">Liczba odda≈Ñ: {{ liczba_oddan }}</span>
            </div>
            <div class="card-body">

                {% set procent = (suma_ml / cel_ml * 100) if cel_ml > 0 else 0 %}

                <h6 class="text-muted mb-2">Postƒôp w litrach krwi:</h6>
                <div class="progress" style="height: 30px; font-size: 1rem;">
                    <div class="progress-bar {% if procent >= 100 %}bg-success{% else %}bg-krew{% endif %} progress-bar-striped progress-bar-animated"
                         role="progressbar"
                         style="width: {{ procent if procent <= 100 else 100 }}%;"
                         aria-valuenow="{{ procent }}" aria-valuemin="0" aria-valuemax="100">
                        {{ procent|round(1) }}%
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-2 mb-4 fw-bold">
                    <span>{{ suma_ml }} ml</span>
                    <span>Cel: {{ cel_ml }} ml</span>
                </div>

                <form method="POST" action="/dawca/cel" class="row g-2 align-items-center bg-light p-2 rounded">
                    <div class="col-auto">
                        <label class="col-form-label">Zmie≈Ñ cel (ml):</label>
                    </div>
                    <div class="col-auto">
                        <input type="number" name="cel" value="{{ cel_ml }}" min="0" max="126900" class="form-control" style="width: 120px;" required>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-sm btn-outline-dark">Zapisz</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <div class="card shadow-sm h-100 border-start border-4 border-info">
                    <div class="card-body">
                        <p class="text-muted small mb-1">Ostatnie oddanie</p>
                        <h5 class="fw-bold text-dark">
                            {% if ostatnie %}{{ ostatnie }}{% else %}-{% endif %}
                        </h5>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm h-100 border-start border-4 border-success">
                    <div class="card-body">
                        <p class="text-muted small mb-1">Mo≈ºesz oddaƒá krew:</p>
                        <h5 class="fw-bold text-success">
                            {% if najblizsze %}{{ najblizsze }}{% else %}Teraz!{% endif %}
                        </h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">Wyniki bada≈Ñ laboratoryjnych</h5>
            </div>
            <div class="card-body p-0">
                {% if historia_badan %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-dark">
                        <tr>
                            <th>Data badania</th>
                            <th>Rodzaj</th>
                            <th>Wynik</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for badanie in historia_badan %}
                        <tr>
                            <td>{{ badanie[0] }}</td>
                            <td>{{ badanie[1] }}</td>
                            <td>
                                {% if badanie[2] == 'negatywny' %}
                                <span class="badge bg-success">NEGATYWNY (OK)</span>
                                {% elif badanie[2] == 'pozytywny' %}
                                <span class="badge bg-danger">POZYTYWNY (!)</span>
                                {% else %}
                                {{ badanie[2] }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="p-4 text-center text-muted">
                    Brak historii bada≈Ñ.
                </div>
                {% endif %}
            </div>
        </div>

    </div>

    <div class="col-lg-4">

        <div class="card shadow mb-4">
            <div class="card-header bg-krew text-white">
                <h5 class="mb-0">Szybkie akcje</h5>
            </div>
            <div class="card-body d-grid gap-2">
                <a href="/dawca/zgloszenia-oddania" class="btn btn-outline-danger text-start p-3">
                    ü©∏ <strong>Zg≈Çoszenia i historia</strong><br>
                    <small class="text-muted">Sprawd≈∫ historiƒô swoich donacji</small>
                </a>

                <a href="/dawca/dane" class="btn btn-outline-secondary text-start p-3">
                    üë§ <strong>Twoje dane</strong><br>
                    <small class="text-muted">Grupa krwi, PESEL, adres</small>
                </a>

                <a href="/dawca/przekazania" class="btn btn-outline-success text-start p-3">
                    ‚ù§Ô∏è <strong>Komu pomog≈Çem?</strong><br>
                    <small class="text-muted">Sprawd≈∫ wykorzystanie Twojej krwi</small>
                </a>
            </div>
        </div>

        <div class="card shadow-sm bg-light">
            <div class="card-body">
                <h6 class="card-title">Ustawienia konta</h6>
                <p class="small text-muted">Chcesz zmieniƒá login lub has≈Ço?</p>

                <button class="btn btn-primary w-100 mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#editUserBox">
                    Edytuj dane logowania
                </button>

                <div class="collapse" id="editUserBox">
                    <div class="card card-body border-0 shadow-sm">
                        <form method="POST" action="/uzytkownik/edytuj">
                            <div class="mb-3">
                                <label class="form-label small fw-bold">Login</label>
                                <input type="text" name="login" class="form-control" value="{{ session['login'] if session['login'] else '' }}" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold">Nowe has≈Ço</label>
                                <input type="password" name="haslo" class="form-control" placeholder="Zostaw puste by nie zmieniaƒá">
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-sm">Zapisz zmiany</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}