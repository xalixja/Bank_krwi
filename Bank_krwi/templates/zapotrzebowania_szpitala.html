<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Zapotrzebowania szpitala</title>
</head>
<body>

<h1>Zapotrzebowania szpitala</h1>
<p><a href="/szpital">⬅ Powrót do panelu</a></p>

<h2>Lista zapotrzebowań</h2>

<table border="1" cellpadding="6">
    <tr>
        <th>ID</th>
        <th>Grupa krwi</th>
        <th>Ilość (ml)</th>
        <th>Status</th>
        <th>Data wydania</th>
        <th>Akcje</th>
    </tr>

    {% for z in zapotrzebowania %}
    <tr>
        <td>{{ z[0] }}</td>
        <td>{{ z[1] }}{{ z[2] }}</td>
        <td>{{ z[3] }}</td>

        <td {% if z[4] == 'oczekujace' %}
        style="color: orange; font-weight: bold;"
        {% else %}
        style="color: green; font-weight: bold;"
        {% endif %}
        >
        {{ z[4] }}
        </td>

        <td>{{ z[5] }}</td>

        <td>
            {% if z[4] == 'oczekujace' %}
            <button onclick="toggleEdit({{ z[0] }})">Edytuj</button>

            <form method="POST" action="/szpital/zapotrzebowania/usun/{{ z[0] }}" style="display:inline;">
                <button type="submit">Usuń</button>
            </form>
            {% else %}
            —
            {% endif %}
        </td>
    </tr>

    <!-- FORMULARZ EDYCJI -->
    {% if z[4] == 'oczekujace' %}
    <tr id="edit-{{ z[0] }}" style="display:none;">
        <td colspan="6" style="background:#f3f3f3; padding:10px;">
            <form method="POST" action="/szpital/zapotrzebowania/edytuj/{{ z[0] }}">
                <p>Grupa krwi:
                    <select name="grupa">
                        <option value="A" {% if z[1]=='A' %}selected{% endif %}>A</option>
                        <option value="B" {% if z[1]=='B' %}selected{% endif %}>B</option>
                        <option value="AB" {% if z[1]=='AB' %}selected{% endif %}>AB</option>
                        <option value="0" {% if z[1]=='0' %}selected{% endif %}>0</option>
                    </select>
                </p>

                <p>Rh:
                    <select name="rh">
                        <option value="+" {% if z[2]=='+' %}selected{% endif %}>+</option>
                        <option value="-" {% if z[2]=='-' %}selected{% endif %}>-</option>
                    </select>
                </p>

                <p>Ilość (ml):
                    <input type="number" name="ilosc_ml" value="{{ z[3] }}" required>
                </p>

                <button type="submit">Zapisz zmiany</button>
            </form>
        </td>
    </tr>
    {% endif %}
    {% endfor %}
</table>

<script>
    function toggleEdit(id) {
        const row = document.getElementById("edit-" + id);
        row.style.display = row.style.display === "none" ? "table-row" : "none";
    }
</script>

